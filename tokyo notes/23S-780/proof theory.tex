\documentclass{../../small}
\usepackage{../../ikhanchoi}
\usepackage{proof}

\DeclareMathOperator{\Var}{Var}
\DeclareMathOperator{\Tm}{Tm}
\DeclareMathOperator{\Fml}{Fml}
\DeclareMathOperator{\Seq}{Seq}

\begin{document}
\title{Proof Theory}
\author{Ikhan Choi\\Lectured by Toshiyasu Arai\\University of Tokyo, Spring 2023}
\maketitle
\tableofcontents

\newpage
\section{Day 1: April 10}

In this lecture we only consider classical 1st order logic.

Completeness theorem
\[\text{logically valid}\quad\Leftrightarrow\quad\text{provable}\]
If a statement is provable, then it is true, isn't it?
If a statement can't be proved, then it is not true, is it?
No!

Most references share the common notion of logical validity, but provability slightly differs although they are same eventually.
Provability depends on the choice of axioms and inference rules, and we will choose G. Gentzen's(1934/35).

Informally,
\begin{itemize}
\item a \emph{formula} is a formal expression which represents propositions,
\item the truth of a formula is determined by a \emph{structure} and \emph{satisfaction relation},
\item a \emph{language} can give strucures their shapes.
\end{itemize}
\begin{defn}
A language is a set $\cL$ of symbols.
The set of symbols $\cL=\cF\cup\cP$ are divided into two categories: functions and predicates(also called relations or conditions).
A non-negative integer, called arity, is assigned to each symbol.
A 0-ary function is called a constant.
We will write the set of $n$-ary function symbols as $\cF_n$ and $n$-ary predicate symbols as $\cP_n$.
(Symbols given in a language is somtimes called non-logical symbols, because they depend on the definition of languages.)
\end{defn}

\begin{defn}
Let $\cL$ be a language.
An $\cL$-structure is a pair $\cM=(M,F)$ of a set $M$ and a function $F$ with domain $\cL$ such that $F(p)=p^\cM\subset M^n$, $F(f)=f^\cM:M^n\to M$.
\end{defn}

\begin{defn}[Term]
Let $\cL$ be a language.
A variable is an element of a countable set $\Var$ such that $\Var\cap\cL=\varnothing$.
A term is an element of $\Tm_\cL$, recursively defined such that
\begin{parts}
\item $\Var\subset\Tm_\cL$,
\item If $t_1,\cdots,t_n\in\Tm_\cL$ and $f\in\cF_n$, then $f(t_1,\cdots,t_n)\in\Tm_\cL$.
\end{parts}
\end{defn}


Let $\cM$ be an $\cL$-structure and let $\cL(\cM):=\cL\cup\{c_\alpha:\alpha\in M\}$.
$\cM$ is a $\cL(\cM)$-structure by letting $c_\alpha^\cM:=\alpha$.
A closed term is a term which does not contain any variables, so that it is recursively constructed from constants by functions.
Let $\cM$ be an $\cL$-structure and $t$ be a closed $\cL(\cM)$-term.
If $t\equiv f(t_1,\cdots,t_n)$ (completely equal as sequences of symbols), then $t^\cM$ is recursively defined by $t^\cM:=f^\cM(t_1^\cM,\cdots,t_n^\cM)\in M$.


\begin{defn}[Formula]
Let $\cL$ be a language.
A formula is an element of $\Fml_\cL$, recursively defined such that
\begin{parts}
\item if $t_1,\cdots,t_n\in\Tm_\cL$ and $p\in\cP_n$, then $p(t_1,\cdots,t_n)\in\Fml_\cL$,
\item if $A,B\in\Fml_\cL$, then $\neg A,\ A\vee B,\ A\wedge B,\ A\to B\in\Fml_\cL$,
\item if $A\in\Fml_\cL$ and $x\in\Var$, then $\exists x\,A,\ \forall x\,A\in\Fml_\cL$.
\end{parts}
The symbols $\neg,\ \vee,\ \wedge,\ \to$ are called connectives, and the symbols $\exists,\ \forall$ are called quantifiers.
They are called logical symbols, which does not depend on languages. 
\end{defn}

\begin{defn}[Free variables]
For a term $t$, the set $\Var(t)\subset\Var$ is defined as
\begin{parts}
\item if $x\in\Var$, then $\Var(x)=\{x\}$,
\item $\Var(f(t_1,\cdots,t_n))=\bigcup_{i=1}^n\Var(t_i)$.
\end{parts}
For a formula $A$, the set $\Var(A)\subset\Var$ is defined as
\begin{parts}
\item $\Var(p(t_1,\cdots,t_n))=\bigcup_{i=1}^n\Var(t_i)$.
\item if $\circ\in\{\vee,\wedge,\to\}$, then $\Var(A\circ B)=\Var(A)\cup\Var(B)$,
\item if $\circ\in\{\exists,\forall\}$ and $x\in\Var$, then $\Var(\circ x\,A)=\Var(A)\setminus\{x\}$.
\end{parts}
An element of $\Var(A)$ is called a free variable, and a formula $A$ is said to be closed if $\Var(A)=\varnothing$.
\end{defn}

\begin{defn}[Satisfiability relation]
Let $A$ be a closed formula over $\cM$.
We write $\cM\models A$ and say $A$ holds on $\cM$ or $\cM$ satisfies $A$ if
\begin{parts}
\item $\cM\models p(t_1,\cdots,t_n)$ iff $(t_1^\cM,\cdots,t_n^\cM)\in p^\cM$,
\item $\cM\models\neg A$ iff $\cM\not\models A$,
\item $\cM\models A\vee B$ iff $\cM\models A$ or $\cM\models B$ (similarly for $\wedge$ and $\to$),
\item $\cM\models\exists x\,A$ iff there is $\alpha\in M$ such that $\cM\models A[x:=c_\alpha]$, where $A[x:=c_\alpha]$ is the result of replacing the variable $x$ by $c_\alpha$ in $A$ (similarly for $\forall$).
\end{parts}
\end{defn}



\iffalse
First order syntax

variables
	functions
terms
	a relation
literals
	connectives
formulas
	quantifiers
sentences
\fi



\section{Day 2: April 17}

Let $A$ be a formula.
Then, the universal closure is $\forall(A):=\forall x_1\cdot\forall x_n\,A$, where $\{x_1,\cdots,x_n\}=\Var(A)$.

\begin{defn*}
A formula $A$ is called \emph{logically valid} if its universal closure holds on every structure $\cM$ and write $\models A$.
A formula $A$ is called to be \emph{logically equivalent} to another formula $B$ if $\models A\leftrightarrow B$.
\end{defn*}

\begin{defn*}
A \emph{literal} is an atomic formula or its negation.
A \emph{negation normal form}(nnf) of a formula is a formula in which negation symbols are placed as inner as possible.
We may also write
\[nnf::=literals\mid A_0{\wedge\atop\vee}A_1\mid{\exists\atop\forall}x\,A.\]
\end{defn*}

\begin{prop*}
For each formula $A$, there is a logically equivalent nnf.
\end{prop*}

\begin{pf}
We have four logically valid formulas
\begin{align*}
&\models(A\to B)\leftrightarrow(\neg A\vee B),\\
&\models\neg(A{\vee\atop\wedge}B)\leftrightarrow(\neg A{\wedge\atop\vee}\neg B),\\
&\models\neg({\exists\atop\forall}x\,A)\leftrightarrow{\forall\atop\exists}x\,\neg A,\\
&\models\neg\neg A\leftrightarrow A.\qedhere
\end{align*}
\end{pf}

\subsection*{1. Sequent calculus}
\setcounter{section}{1}

Languages are assumed to be countable.
\begin{defn}
A finite set of formulas in nnf is said to be a \emph{sequent}. % 推件
Then, a sequence $\{A_1,\cdots,A_n\}$ intends to be the disjunction $A_1\vee\cdots\vee A_n$.
Greek alphabets $\Gamma,\Delta$ will be used to denote sequents, and comma between sequents actually mean their union, i.e. $\Gamma,\Delta=\Gamma\cup\Delta$, and $\Gamma,\{A\}=\Gamma\cup\{A\}$.
The empty sequent denotes an absurdity.
\end{defn}

\begin{defn}[Sequent calculus]
Our sequent calculus $\G$ is a proof system defined as follows.
We have only one logical axiom for $\G$:
\begin{itemize}
\item $\Gamma,L,\bar{L}$ for arbitrary sequent $\Gamma$ and literal $L$.
\end{itemize}
We have the following inference rules for $\G$:
\begin{itemize}
\item \qquad$\infer[^{(\vee)}]{\Gamma}{\Gamma,A_0,A_1}$\qquad if $(A_0\vee A_1)\in\Gamma$.
\item \qquad$\infer[^{(\wedge)}]{\Gamma}{\Gamma,A_0 & \Gamma,A_1}$\qquad if $(A_0\wedge A_1)\in\Gamma$.
\item \qquad$\infer[^{(\exists)}]{\Gamma}{\Gamma,A(t)}$\qquad if $(\exists x\,A(x))\in\Gamma$, where $A(t):\equiv A[x:=t]=A[t/x]$.
\item \qquad$\infer[^{(\forall)}]{\Gamma}{\Gamma,A(a)}$\qquad if $(\forall x\,A(x))\in\Gamma$, provided that the variable $a$ does not occur in any formulas in $\Gamma$. Such a variable $a$ is called \emph{eigenvariable} of the rule $(\forall)$.
\end{itemize}
We also consider another inference rule, which is not for $\G$:
\begin{itemize}
\item \qquad$\infer[^{(cut)}]{\Gamma}{\Gamma,\neg C & C,\Gamma}$\qquad
\end{itemize}
In a proof system, derivable seuqents are defined recursively as follows: all logical axioms are derivable, for each inference rule the lower sequent is derivable if all sequents in the upper sequent is derivable.
\end{defn}

\begin{thm}[Soundness of $\G+(\mathrm{cut})$]
If $\G+(\mathrm{cut})\vdash\Gamma$, then $\models\Gamma$.
\end{thm}
\begin{pf}
We can check from definition.
\end{pf}

\begin{thm}[Completeness of $\G$]
If $\models\Gamma$, then $\G\vdash\Gamma$.
\end{thm}

\begin{cor}[Cut elimination theorem]
If $\G+(\mathrm{cut})\vdash\Gamma$, then $\G\vdash\Gamma$.
\end{cor}
\begin{pf}
Clear from the soundness of $\G+(\mathrm{cut})$ and the completeness of $\G$.
\end{pf}

\begin{cor}[Weakening]
If $\G\vdash\Gamma$, then $\G\vdash\Gamma,\Delta$.
\end{cor}
\begin{pf}
In the proof tree, add $\Delta$ in every nodes(sequents).
Then, every inference rule is preserved (for ($\forall$)-rule, we can obtain same result by changing eigenvariables into another eigenvariables, and it is done because the eigenvariables are finite and the set of variables is countebly infinite).
\end{pf}
\begin{prop}
$\G\vdash\Gamma,\neg A,A$. (Note that $A$ is not a literal in general, it is not a logical axiom)
\end{prop}
\begin{pf}
It is done by induction on the number of $\vee,\wedge,\exists,\forall$ occurring in $A$.
For $\vee$,
\[\infer[^{(\wedge)}]{\Gamma,\neg(A_0\vee A_1),A_0\vee A_1}{\infer[^{(\vee)}]{\Gamma,\neg A_0,A_0\vee A_1}{\Gamma,\neg A_0,A_0} & \infer[^{(\vee)}]{\Gamma,\neg A_1, A_0\vee A_1}{\Gamma,\neg A_1,A_1}}.\]
For $\exists$,
\[\infer[^{(\forall)}]{\Gamma,\neg(\exists x\,A(x)),\exists x\,A(x)}{\infer[^{(\exists)}]{\Gamma,\neg A(a),\exists x\,A(x)}{\Gamma,\neg A(a),A(a)}},\]
where $a$ is an eigenvariable.
(Here, we cannot change the order of $(\forall)$-rule and $(\exists)$-rule because the eigenvariable can occur in inferences)
\end{pf}



\newpage
\setcounter{section}{2}
\section{Day 3: April 24}
\subsubsection*{Completeness of propositional logic}
\begin{itemize}
\item atoms(propositional variables): $p_0,\ p_1,\ p_2,\ \cdots$.
\item literals: $p_0,\ \bar{p_0},\ p_1,\ \bar{p_1},\ \cdots$
\item formulas: $A::=p\mid\bar p\mid A\vee A\mid A\wedge A$
\item truth assignment: $\nu:\{p_0,p_1,\cdots\}\to\{0,1\}$
\end{itemize}

For connectives, truth assignment must satisfy
\[\nu(\bar p)=1-\nu(p),\quad\nu(A_0\vee A_1)=\max\{\nu(A_0),\nu(A_1)\},\quad\nu(A_0\wedge A_1)=\min\{\nu(A_0),\nu(A_1)\}.\]
We say a formula $A$ is tautoloy if $\nu(A)=1$ for all truth assignment $\nu$, and satisfiable if $\nu(A)=1$ for some truth assignment $\nu$.

\begin{defn*}[$\G_0$; propositional fragment of $\G$]
axioms
\begin{itemize}
\item $\Gamma,p,\bar p$
\end{itemize}
rules
\begin{itemize}
\item $\infer[(\vee)]{\Gamma}{\Gamma,A_0,A_1}$ if $(A_0\vee A_1)\in\Gamma$
\item $\infer[(\wedge)]{\Gamma}{\Gamma,A_0 & \Gamma,A_1}$ if $(A_0\wedge A_1)\in\Gamma$
\end{itemize}
\end{defn*}

Soundness of $\G_0$ means that $\G_0\vdash\Gamma$ implies that $\bigvee\Gamma$ is a tautology, and completeness means the converse.

\begin{pf}[Proof of completeness]
$T\subset{}^{<\omega}2=\bigcup_{n=0}^\infty 2^n$ is a tree iff $T\ne\varnothing$, $\sigma*\tau\in T$ implies $\sigma\in T$($*:2^n\times 2^{m-n}\to 2^m$ is the concatentation $(a_0,\cdots,a_{n-1})*(a_n,\cdots,a_{m-1})=(a_0,\cdots,a_{m-1})$).
Each element means a node, and the length of node means the depth.

Define the following recursively on sequences($=$nodes)  $\sigma\in{}^{<\omega}2$ and a tree $T$($=\varnothing$initially):
\begin{itemize}
\item $\mathrm{Seq}(\sigma)=\mathrm{Seq}_0(\sigma)\cup\mathrm{Seq}_1(\sigma)=$ sequents at $\sigma$.
\item $\mathrm{Ord}(\sigma)=$ total order on $\mathrm{Seq}_0(\sigma)$
\item for the empty sequence $\varnothing$($=$root node),
\[\mathrm{Seq}_0(\varnothing):=NL(\Gamma)=\text{non-literals in $\Gamma$},\quad\mathrm{Seq}_1(\varnothing):=L(\Gamma)=\text{literals in $\Gamma$}.\]
\item if $\mathrm{Seq}(\sigma)$ is an axiom, that is, there is an atom $p$ such that $\{p,\bar p\}\subset\mathrm{Seq}(\sigma)$, then $\sigma$ is a leaf of $T$.
\item if $\mathrm{Seq}_0(\sigma)=\varnothing$, then $\sigma$ is a leaf of $T$.
\item Suppose $B$ is the leftmost member of $\mathrm{Seq}_0(\sigma)$; we have two cases.\\
The first case is $B\equiv A_0\vee A_1$.
We put $\sigma*(0)$ into $T$ and write
\[\mathrm{Seq}_0(\sigma)=A_0\vee A_1,\Gamma_0,\quad\mathrm{Seq}_1(\sigma)=\Gamma_1.\]
Then,
\[\Seq_0(\sigma*(0)):=\Gamma_0,NL(A_0,A_1),\quad\Seq_1(\sigma*(0)):=\Gamma_1,A_0\vee A_1,L(A_0,A_1).\]
For the second case $B\equiv A_0\wedge A_1$, we put $\sigma*(0)$ and $\sigma*(1)$ into $T$ and write
\[\mathrm{Seq}_0(\sigma)=A_0\wedge A_1,\Gamma_0,\quad\mathrm{Seq}_1(\sigma)=\Gamma_1.\]
Then,
\[\Seq_0(\sigma*(0)):=\Gamma_0,NL(A_0),\quad\Seq_1(\sigma*(0)):=\Gamma_1,A_0\wedge A_1,L(A_0),\]
\[\Seq_0(\sigma*(1)):=\Gamma_0,NL(A_1),\quad\Seq_1(\sigma*(1)):=\Gamma_1,A_0\wedge A_1,L(A_1).\]
\end{itemize}
The decomposition $\mathrm{Seq}(\sigma)=\mathrm{Seq}_0(\sigma)\cup\mathrm{Seq}_1(\sigma)$ is introduced in order to avoid
\[\infer{A_0\vee A_1,\Gamma}{\infer{A_0,A_1,A_0\vee A_1,\Gamma}{\infer{A_0,A_1,A_0,A_1,A_0\vee A_1,\Gamma}{\vdots}}}.\]
The set $\mathrm{Seq}_0(\sigma)$ is the set of \emph{unanalyzed sequents}, which contains non-literals only.
We will write the decomposition as $\mathrm{Seq}(\sigma)=\mathrm{Seq}_0(\sigma);\mathrm{Seq}_1(\sigma)$.
The tree $T$ is finite because if we define $lc(A)$ as the number of occurences of $\vee,\wedge$ in $A$ and $lc(\sigma)=\sum_{A\in\Seq_0(\sigma)} lc(A)$, then we can check $lc(\sigma)>lc(\sigma*(i))$ for $i\in\{0,1\}$.

Now we suppose $\G_0\not\vdash\Gamma$ so that there is a leaf $\sigma\in T$ such that $\Seq(\sigma)$ is not an axiom.
For every atom $p$, we have $\{p,\bar p\}\not\subset\Seq_1(\sigma)$.
Define any truth assignment $\nu$ such that
\[\nu(l)=0\text{ for literals }l\in\Seq_1(\sigma).\]

Define for the leaf $\sigma$ a set
\[S:=\bigcup_{\exists\rho,\tau*\rho=\sigma}\Seq(\tau).\]
In other words, $A\in S$ iff $A$ occurs in the path from $\sigma$ to the root.
Let $B\in S$.
We claim $\nu(B)=0$.
Use the induction on $lc(B)$.
If $B$ is a literal, then $\nu(B)=0$ by definition of $\nu$.
If $B\equiv A_0\vee A_1$, then we can show $\{A_0,A_1\}\subset S$, so $\nu(B)=0$ by the induction hypothesis.
If $B\equiv A_0\wedge A_1$, then we can show $\{A_0,A_1\}\cap S\ne\varnothing$, so $\nu(B)=0$ by the induction hypothesis.
From $\Gamma\subset S$, we have $\nu(A)=0$ for all $A\in\Gamma$, so $\nu(\bigvee\Gamma)=0$, i.e. $\bigvee\Gamma$ is not a tautology.
\end{pf}



\newpage
\section{Day 4: May 1}
\subsection*{Completeness of first order logic}

Assuming $\G\not\vdash\Gamma$, we have to construct a structure $\cM$ such that $\cM\not\models\bigvee\Gamma$ (i.e.$\cM\not\models\forall\bigvee\Gamma$, the universal closure).
For this, we have to make a set and construct interpretations of each symbol of the given language, the set of non-logical symbols.

(1)
For universal formula,
\[\infer{\forall x\,A(x),\cdots;}{\cdots, NL(A(a));\cdots,\forall x\,A(x),L(A(a))}.\]

(2)
Suppose an existential formula $\exists x\,A(x)$ occurs in a path $P$.
Note that $\cM\not\models \exists x\,A(x)$ implies $\cM\not\models A(t)$ for any term $t$.
For each term $t$, $A(t)$ should occur in the path $P$.
Define $\Tm(\sigma;\exists x\,B(x))$ such that $t\in\Tm(\sigma;\exists x\,B(x))$ if and only if an inference
\[\infer{\exists x\,B(x),\cdots;\cdots}{\cdots,B(t);\cdots}\]
occurs in the path from the root $\varnothing$ to the node $\sigma$.

Now we are going to construct a tree $T$ recursively from the root as follows:
\begin{enumerate}[\text{Case} 1:]
\item
$\Seq_1(\sigma)\supset\{L,\bar{L}\}$ for some literal $L$, then we stop to prolong the tree.
In what follows, assume no literals satisfy $\Seq_1(\sigma)\supset\{L,\bar{L}\}$.

\item
$\Seq_0(\sigma)=\varnothing$, then we repeat as
\[\infer{\varnothing;\Seq_1(\sigma)}{\varnothing;\Seq_1(\sigma)}.\]
Now let $A$ be the leftmost formula in $\Seq_0(\sigma)$.

\item
$A\equiv A_0\vee A_1$.
As in the last lecture.

\item
$A\equiv A_0\wedge A_1$.
As in the last lecture.

\item
$A\equiv\forall x\,B(x)$.
Then, we extend the tree as follows:
\[\infer{\forall x\,B(x),\Gamma_0;\Gamma_1}{\Gamma_0,NL(B(a));\Gamma_1,\forall x\,B(x),L(B(a))}.\]

\item
$A\equiv\exists x\,B(x)$.
Let $t\equiv t_n$ be the first one in the enumeration $\Tm=\{t_0,t_1,\cdots\}$ such that $t_n\notin\Tm(\sigma;\exists x\,B(x))$.
Then, we can extend the tree as
\[\infer{\exists x\,B(x),\Gamma_0;\Gamma_1}{\Gamma_0,NL(B(t)),\exists x\,B(x);\Gamma_1,L(B(t))}.\]
Note that we have put $\exists x\,B(x)$ into $\Seq_0$, not $\Seq_1$.
\end{enumerate}

Suppose $\G\not\vdash\Gamma$.
If $T$ is finite, then every leaf is an axiom so that the tree is indeed a derivation of $\Gamma$, $T$ is infinite.
By K\"onig's infinity lemma, there exists an infinite path $P$ through the constructed binary tree $T$.

\begin{pf}[Proof of K\"onig's lemma]
The lemma holds for general connected locally finite infinite graphs, but we assume the graph is tree.
Choose $\sigma_n$ recursively as follows: suppose $\sigma_n$ satisfies that $\{\tau:\sigma*\tau\in T\}$ is infinite.
By the local finiteness, there is $i$ such that $\{\tau:\sigma*(i)*\tau\in T\}$ is infinite.
Let $\sigma_{n+1}:=\sigma_n*(i)$.
Then, $\sigma_n$ defines an infinite path in $T$.
\end{pf}

Now we construct the \emph{Herbrand structure} $\cM=\<M;f^\cM,\cdots,R^\cM,\cdots\>$ as:
\begin{itemize}
\item $M:=\Tm(\cL)$,
\item $f^\cM(t_1,\cdots,t_n):=f(t_1,\cdots,t_n)$,
\item $R^\cM(t_1,\cdots,t_n)$ is true if and only if
\[R(t_1,\cdots,t_n)\notin\Seq(P):=\bigcup_{\sigma\in P}\Seq(\sigma)\]
\end{itemize}
Then, $\cM\models\bar{L}$ if and only if $L\in\Seq(P)$ for literals $L$.
\begin{clm*}
If $A\in\Seq(P)$, then $\cM\not\models A$.
\end{clm*}
\begin{pf}
Define the literal complexity $lc(A)$ by the number of occurrences of logical symbols in $A$, and use induction on $lc(A)$.

For the Case 5: $A\equiv\forall x\,B(x)$.
We have $B(a)\in\Seq(P)$ so that $\cM\not\models B(a)$ by the induction hypothesis.

For the Case 6: $A\equiv\exists x\,B(x)$.
We have $\exists x\,B(x)\in\Seq(P)$, and it implies $\{B(t):t\in\Tm\}\subset\Seq(P)$.
By the induction hypothesis, $\cM\not\models B(t)$ for all $t\in\Tm$, hence $\cM\not\models\exists xB(x)$.
\end{pf}

% 계산이론이 필요한 경우 관계의 해석을 원자식이 아니라 임의의 식에 대해 정의하고 그것이 타르스키의 진리론(컨벤션)을 만족함을 보일 수 있다.
\end{document}

















めんどくせ
ちゃんと書くね
ちょいちょい
しゃべっていい？